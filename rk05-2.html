<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>fritzm.github.io - PDP-11/45: RK05 II - Head Load and Servo Calibration</title>
    <meta name="description" content="">
    <meta name="author" content="Fritz Mueller">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="https://fritzm.github.io/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="https://fritzm.github.io/theme/bootstrap.min.css" rel="stylesheet">
    <link href="https://fritzm.github.io/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="https://fritzm.github.io/theme/local.css" rel="stylesheet">
    <link href="https://fritzm.github.io/theme/pygments.css" rel="stylesheet">

    <!-- Photoswipe -->
    <link rel="stylesheet" href="https://fritzm.github.io/theme/photoswipe.css">
    <link rel="stylesheet" href="https://fritzm.github.io/theme/default-skin/default-skin.css">
    <script src="https://fritzm.github.io/theme/photoswipe.min.js"></script>
    <script src="https://fritzm.github.io/theme/photoswipe-ui-default.min.js"></script>
    <script src="https://fritzm.github.io/galleries.js"></script>
    <script type="text/javascript">
        var pswipe = function(gname, index) {
            var pswpElement = document.querySelectorAll('.pswp')[0];
            var items = galleries[gname];
            var options = { index: index };
            var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
            gallery.init();
        };
    </script>

    <!-- So Firefox can bookmark->"abo this site" -->
        <link href="https://fritzm.github.io/feeds/all.rss.xml" rel="alternate" title="fritzm.github.io" type="application/rss+xml">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="https://fritzm.github.io">fritzm.github.io</a>

        <div class="nav-collapse">
        <ul class="nav">
            
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
    <div class='article'>
        <div class="content-title">
            <h1>PDP-11/45: RK05 II - Head Load and Servo Calibration</h1>
Sun 09 April 2017

by <a class="url fn" href="https://fritzm.github.io/author/fritz-mueller.html">Fritz Mueller</a>
 


        </div>
	
        <div><p>Okay, disassembled and cleaned a few RK05 cartidges, following advice from the vcfed forum and cctalk
mailing list (cleanroom gloves and wipes, 99% anyhydrous isoprop).  Was surprised to find foam inside
the hub on the disks (see pic below) but folks on vcfed advise that it is high-density polyeurethane
and not subject to decay to the same extent as the other DEC foams, so I left it be.</p>
<p>Mounted one of the cleaned packs, and let it spin in the drive for a few hours with head load disabled
in order to get a good flush on the air filtration system, let the various bearings on the drive loosen up,
and make sure the replacement head retract batteries got a good charge.  Drive ran quiet and balanced.</p>
<p>After that, took a deep breath and let the heads load -- no crash!  Proceeded to work through the dynamic
off-line calibration procedure for the head positioning servo system.  This involves jumpering the control
electronics on the drive to strobe simulated cylinder addresses from the sector counter.  That provides
a convenient source of oscillating seeks that can be used to calibrate the servos.  Video here shows head
load, a four cylinder oscillating seek, and a scope trace of the resulting sine position output of the electro-optical carriage position sensor:</p>
<p><span class="videobox">
                    <iframe width="640" height="390"
                        src='https://www.youtube.com/embed/b6p2ri-uM9c?rel=0'
                        frameborder='0' webkitAllowFullScreen
                        mozallowfullscreen allowFullScreen>
                    </iframe>
                </span></p>
<p>Surprisingly, after about thirty years of non-operation, all of the servo calibration was within specified
error bars, so no adjustments were necessary!  At this point I decided to go for broke, cabled the drive
to the RK11-C controller and attempted a boot.  Some cncouraging front panel indicator activity, but soon
halted with a seek error flagged in RKER.  Not too surprising.</p>
<p>Okay, on to debugging the drive online with the controller, then. Worked up the following test code, inspired
by something in one of the RK05 SPI workbooks.  This reads two cylinder addresses from the high and low
bytes of the front panel switches, and instructs the controller to instruct the drive to seek alternately
between them:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="err">        177570                          SW=177570</span>
<span class="err">        177400                          RKDS=177400</span>
<span class="err">        177404                          RKCS=177404</span>
<span class="err">        177412                          RKDA=177412</span>
<span class="err">000000                                  .ASECT</span>
<span class="err">        001000                          .=1000</span>
<span class="err">001000  012706  000700          START:  MOV     #700,SP         ;INIT STACK POINTER</span>
<span class="err">001004  013700  177570          L0:     MOV     @#SW,R0         ;RETRIEVE SWITCHES</span>
<span class="err">001010  000300                          SWAB    R0              ;LOWER SWITCHES TO UPPER</span>
<span class="err">001012  004767  000012                  JSR     PC,SEEK         ;DO THE SEEK</span>
<span class="err">001016  013700  177570                  MOV     @#SW,R0         ;RETRIEVE SWITCHES</span>
<span class="err">001022  004767  000002                  JSR     PC,SEEK         ;DO THE SEEK</span>
<span class="err">001026  000766                          BR      L0              ;START OVER</span>
<span class="err">001030  042700  000377          SEEK:   BIC     #377,R0         ;MASK OFF LOWER BYTE</span>
<span class="err">001034  072027  177775                  ASH     #-3,R0          ;SHIFT OVER TO CYL ADDRESS</span>
<span class="err">001040  105737  177404          L1:     TSTB    @#RKCS          ;CHECK RKCS RDY BIT</span>
<span class="err">001044  100375                          BPL     L1              ;LOOP IF BUSY</span>
<span class="err">001046  032737  000100  177400  L2:     BIT     #100,@#RKDS     ;CHECK RKDS ARDY BIT</span>
<span class="err">001054  001774                          BEQ     L2              ;LOOP IF BUSY</span>
<span class="err">001056  010037  177412                  MOV     R0,@#RKDA       ;WRITE SEEK TARGET TO RKDA</span>
<span class="err">001062  012737  000011  177404          MOV     #11,@#RKCS      ;WRITE SEEK CMD + GO TO RKCS</span>
<span class="err">001070  000207                          RTS     PC              ;RETURN TO CALLER</span>
<span class="err">        001000                          .END    START</span>
</code></pre></div>
</td></tr></table>

<p>At first this code was generating no seek activity on the drive.  Decided to try swapping out the BC11-A
drive cable, and that produced some limited success -- drive seeks, but some bits of the cylinder address
are still apparently not making it across the cable.</p>
<p>The BC11-A cables are problematic.  They seem flaky and fragile, and many of my spares seem bad.  Any given
cable may beep out fine on the bench, and yet fail consistently in use...  It looks like what's up next is a
voyage through my box of spares, swapping in cables looking for one that works reliably.  Failing that, I'll
need work on some sort of modern replacement, since original BC11-A in good shape are getting hard to find.
It will be sad if at the end of this journey I can't boot the machine for mere lack of a good cable between
the drives and controller!</p>
<p><img src='/images/pdp11/rk05-cartridge-foam_thumbnail_tall.jpg' title='Foam inside the hub of an RK05 pack -- could be bad news if this is decaying like other DEC foam...' onclick='pswipe("pdp11",54);'/>
<img src='/images/pdp11/rk05-running_thumbnail_tall.jpg' title='RK05 running offline from controller; pack spinning and heads loaded' onclick='pswipe("pdp11",55);'/>
<img src='/images/pdp11/BC11-woes_thumbnail_tall.jpg' title='A box of BC11-A cables to be sorted through...' onclick='pswipe("pdp11",56);'/></p></div>
	
        <hr>

    </div>
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="https://fritzm.github.io/archives.html">Archives</a>
                <li><a href="https://fritzm.github.io/tags.html">Tags</a>



                <li><a href="https://fritzm.github.io/feeds/all.rss.xml" rel="alternate">RSS feed</a></li>

            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="https://fritzm.github.io/category/math.html">Math</a></li>
                <li><a href="https://fritzm.github.io/category/pdp-11.html">PDP-11</a></li>
                <li><a href="https://fritzm.github.io/category/programming.html">Programming</a></li>
                   
            </ul>
            </div>




            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="http://facebook.com/fritzmueller">facebook</a></li>
                <li><a href="http://twitter.com/infrafritz">twitter</a></li>
                <li><a href="http://instagram.com/infrafritz">Instagram</a></li>
                <li><a href="http://www.linkedin.com/pub/fritz-mueller/a/679/62/">LinkedIn</a></li>
                <li><a href="http://jsfiddle.net/user/fritzm/fiddles/">JSFiddle</a></li>
                <li><a href="https://github.com/fritzm">GitHub</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="https://fritzm.github.io">fritzm.github.io</a> &copy; Fritz Mueller 2020</p>
</footer>

</div> <!-- /container -->

<!-- Photoswipe -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>
    <div class="pswp__scroll-wrap">
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="https://fritzm.github.io/theme/bootstrap-collapse.js"></script>
 
</body>
</html>